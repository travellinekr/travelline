import { useDroppable } from "@dnd-kit/core";
import { useState, useEffect } from "react";
import { useMutation, useStorage } from "@liveblocks/react/suspense";
import { LiveObject, LiveList } from "@liveblocks/client";
import { Plane, Calendar, Edit2 } from "lucide-react";
import { DateRangePicker } from "./DateRangePicker";
import { TimeSelect } from "./TimeSelect";
import { Autocomplete } from "./Autocomplete";
import type { Card, FlightInfo } from "@/liveblocks.config";
import { KOREAN_AIRPORTS, MAJOR_AIRPORTS } from "@/data/airports";
import { MAJOR_AIRLINES } from "@/data/airlines";
import { calculateTripDays } from "@/utils/calculateTripDays";


interface FlightSectionProps {
    destinationCard?: Card | null;
    addToast: (message: string, type: 'info' | 'warning') => void;
    onConfirm: (data: {
        outbound: {
            date: Date;
            departureAirport: string;
            arrivalAirport: string;
            time: string;
            airline: string;
        };
        return: {
            date: Date;
            departureAirport: string;
            arrivalAirport: string;
            time: string;
            airline: string;
        };
    }) => void;
}

export function FlightSection({ destinationCard, addToast, onConfirm }: FlightSectionProps) {
    const { setNodeRef, isOver } = useDroppable({ id: 'flights-timeline' });

    // Read flight info from Liveblocks storage
    const flightInfo = useStorage((root) => root.flightInfo) as FlightInfo | null;

    // Edit mode toggle
    const [isEditMode, setIsEditMode] = useState(false);

    const [showDatePicker, setShowDatePicker] = useState(false);
    const [departureDate, setDepartureDate] = useState<Date | null>(null);
    const [arrivalDate, setArrivalDate] = useState<Date | null>(null);

    // ê°€ëŠ”í¸ (Outbound) ìƒíƒœ
    const [outboundDepartureAirport, setOutboundDepartureAirport] = useState(`${KOREAN_AIRPORTS[0].name} (${KOREAN_AIRPORTS[0].code})`);
    const [outboundArrivalAirport, setOutboundArrivalAirport] = useState('');
    const [outboundHour, setOutboundHour] = useState('');
    const [outboundMinute, setOutboundMinute] = useState('');
    const [outboundArrivalHour, setOutboundArrivalHour] = useState('');
    const [outboundArrivalMinute, setOutboundArrivalMinute] = useState('');
    const [outboundArrivalDate, setOutboundArrivalDate] = useState<Date | null>(null);
    const [outboundAirline, setOutboundAirline] = useState('');

    // ì˜¤ëŠ”í¸ (Return) ìƒíƒœ - ê¸°ë³¸ê°’ì€ ê°€ëŠ”í¸ì˜ ë°˜ëŒ€, í•˜ì§€ë§Œ ë³€ê²½ ê°€ëŠ¥
    const [returnDepartureAirport, setReturnDepartureAirport] = useState('');
    const [returnArrivalAirport, setReturnArrivalAirport] = useState('');
    const [isReturnDepartureCustom, setIsReturnDepartureCustom] = useState(false);
    const [returnHour, setReturnHour] = useState('');
    const [returnMinute, setReturnMinute] = useState('');
    const [returnArrivalHour, setReturnArrivalHour] = useState('');
    const [returnArrivalMinute, setReturnArrivalMinute] = useState('');
    const [returnArrivalDate, setReturnArrivalDate] = useState<Date | null>(null);
    const [returnAirline, setReturnAirline] = useState('');

    // ë„ì°©ì§€ ê³µí•­ ìë™ ì…ë ¥

    const destinationAirports = destinationCard?.airports || [];
    const hasMultipleAirports = destinationAirports.length > 1;

    // ê³µí•­ì´ 1ê°œë©´ ìë™ ì…ë ¥, ì—¬í–‰ì§€ ë³€ê²½ë˜ë©´ ì´ˆê¸°í™”
    useEffect(() => {
        if (destinationAirports.length === 1) {
            const autoValue = `${destinationAirports[0].name} (${destinationAirports[0].code})`;
            setOutboundArrivalAirport(autoValue);
        } else if (destinationAirports.length === 0) {
            setOutboundArrivalAirport('');
        }
    }, [destinationCard?.id, destinationAirports.length]);

    // ê°€ëŠ”í¸ ê³µí•­ ë³€ê²½ ì‹œ ì˜¤ëŠ”í¸ ê¸°ë³¸ê°’ ìë™ ì—…ë°ì´íŠ¸
    useEffect(() => {
        setReturnDepartureAirport(outboundArrivalAirport);
        setReturnArrivalAirport(outboundDepartureAirport);
    }, [outboundDepartureAirport, outboundArrivalAirport]);

    // Load existing flight data when entering edit mode
    useEffect(() => {
        if (isEditMode && flightInfo) {
            // Load outbound data
            setDepartureDate(new Date(flightInfo.outbound.date));
            setOutboundDepartureAirport(flightInfo.outbound.departureAirport);
            setOutboundArrivalAirport(flightInfo.outbound.arrivalAirport);
            const [outHour, outMin] = flightInfo.outbound.time.split(':');
            setOutboundHour(outHour);
            setOutboundMinute(outMin);
            const [outArrHour, outArrMin] = (flightInfo.outbound.arrivalTime || '00:00').split(':');
            setOutboundArrivalHour(outArrHour);
            setOutboundArrivalMinute(outArrMin);
            if (flightInfo.outbound.arrivalDate) {
                setOutboundArrivalDate(new Date(flightInfo.outbound.arrivalDate));
            }
            setOutboundAirline(flightInfo.outbound.airline);

            // Load return data
            setArrivalDate(new Date(flightInfo.return.date));
            setReturnDepartureAirport(flightInfo.return.departureAirport);
            setReturnArrivalAirport(flightInfo.return.arrivalAirport);
            const [retHour, retMin] = flightInfo.return.time.split(':');
            setReturnHour(retHour);
            setReturnMinute(retMin);
            const [retArrHour, retArrMin] = (flightInfo.return.arrivalTime || '00:00').split(':');
            setReturnArrivalHour(retArrHour);
            setReturnArrivalMinute(retArrMin);
            if (flightInfo.return.arrivalDate) {
                setReturnArrivalDate(new Date(flightInfo.return.arrivalDate));
            }
            setReturnAirline(flightInfo.return.airline);
        }
    }, [isEditMode, flightInfo]);

    const handleDateConfirm = (start: Date, end: Date) => {
        setDepartureDate(start);
        setArrivalDate(end);
    };

    // Save flight info to Liveblocks storage
    const saveFlightInfo = useMutation(({ storage }, flightData: FlightInfo) => {
        storage.set('flightInfo', new LiveObject(flightData));
    }, []);

    // Create day columns
    const createDayColumn = useMutation(({ storage }, dayNum: number) => {
        const columns = storage.get('columns');
        const columnOrder = storage.get('columnOrder');

        if (!columns || !columnOrder) return;

        const dayId = `day${dayNum}`;

        // Check if column already exists
        if ((columns as any).get(dayId)) return;

        // Create column
        (columns as any).set(dayId, new LiveObject({
            id: dayId,
            title: `Day ${dayNum}`,
            cardIds: new LiveList([])
        }));

        // Add to columnOrder
        const orderArray = (columnOrder as any).toArray();
        const day0Index = orderArray.indexOf('day0');

        if (day0Index !== -1) {
            // Insert after day0 and other existing days
            const insertIndex = day0Index + dayNum;
            (columnOrder as any).insert(dayId, insertIndex);
        } else {
            // If day0 doesn't exist, append
            (columnOrder as any).push(dayId);
        }
    }, []);

    const handleConfirm = () => {
        // ê²€ì¦
        if (!departureDate || !arrivalDate ||
            !outboundDepartureAirport || !outboundArrivalAirport ||
            !outboundHour || !outboundMinute || !outboundArrivalHour || !outboundArrivalMinute || !outboundAirline ||
            !returnHour || !returnMinute || !returnArrivalHour || !returnArrivalMinute || !returnAirline) {
            addToast('ëª¨ë“  í•­ê³µí¸ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'warning');
            return;
        }

        // ë„ì°©ì¼ì ìë™ ê³„ì‚°: ë„ì°©ì‹œê°„ì´ ì¶œë°œì‹œê°„ë³´ë‹¤ ì´ë¥´ë©´ ë‹¤ìŒë‚ ë¡œ ê³„ì‚°
        const outboundDepartureTime = parseInt(outboundHour) * 60 + parseInt(outboundMinute);
        const outboundArrivalTimeMinutes = parseInt(outboundArrivalHour) * 60 + parseInt(outboundArrivalMinute);
        const calculatedOutboundArrivalDate = new Date(departureDate);
        if (outboundArrivalTimeMinutes < outboundDepartureTime) {
            calculatedOutboundArrivalDate.setDate(calculatedOutboundArrivalDate.getDate() + 1);
        }

        const returnDepartureTime = parseInt(returnHour) * 60 + parseInt(returnMinute);
        const returnArrivalTimeMinutes = parseInt(returnArrivalHour) * 60 + parseInt(returnArrivalMinute);
        const calculatedReturnArrivalDate = new Date(arrivalDate);
        if (returnArrivalTimeMinutes < returnDepartureTime) {
            calculatedReturnArrivalDate.setDate(calculatedReturnArrivalDate.getDate() + 1);
        }

        // Save to Liveblocks storage
        const flightData: FlightInfo = {
            outbound: {
                date: departureDate.toISOString(),
                departureAirport: outboundDepartureAirport,
                arrivalAirport: outboundArrivalAirport,
                time: `${outboundHour}:${outboundMinute}`,
                arrivalDate: calculatedOutboundArrivalDate.toISOString(),
                arrivalTime: `${outboundArrivalHour}:${outboundArrivalMinute}`,
                airline: outboundAirline
            },
            return: {
                date: arrivalDate.toISOString(),
                departureAirport: returnDepartureAirport,
                arrivalAirport: returnArrivalAirport,
                time: `${returnHour}:${returnMinute}`,
                arrivalDate: calculatedReturnArrivalDate.toISOString(),
                arrivalTime: `${returnArrivalHour}:${returnArrivalMinute}`,
                airline: returnAirline
            }
        };

        saveFlightInfo(flightData);

        // Switch to card view after saving
        setIsEditMode(false);

        // ğŸ†• ì‹¬ì•¼ ì¶œë°œ/ë„ì°©ì„ ê³ ë ¤í•œ ì¼ì°¨ ê³„ì‚°
        const dayCount = calculateTripDays(departureDate, arrivalDate, `${returnHour}:${returnMinute}`);

        // Create Day 1, Day 2, ... columns (Day 0 already exists)
        for (let i = 1; i < dayCount; i++) {
            createDayColumn(i);
        }

        // Also call the original onConfirm for backward compatibility
        onConfirm({
            outbound: {
                date: departureDate,
                departureAirport: outboundDepartureAirport,
                arrivalAirport: outboundArrivalAirport,
                time: `${outboundHour}:${outboundMinute}`,
                airline: outboundAirline
            },
            return: {
                date: arrivalDate,
                departureAirport: returnDepartureAirport,
                arrivalAirport: returnArrivalAirport,
                time: `${returnHour}:${returnMinute}`,
                airline: returnAirline
            }
        });
    };

    return (
        <div className="mb-6">
            {/* í—¤ë” */}
            <div className="flex items-center justify-between mb-2 px-1">
                <h3 className="font-bold text-lg text-slate-800 flex items-center gap-2">
                    <span className="w-1.5 h-5 rounded-full bg-purple-500"></span>
                    í•­ê³µ
                </h3>
                <div className="flex items-center gap-2">
                    <span className="text-[11px] text-slate-400 font-medium">Flights</span>
                    {/* "ë³€ê²½" ë²„íŠ¼: í•­ê³µ ì •ë³´ê°€ ìˆê³  í¸ì§‘ ëª¨ë“œê°€ ì•„ë‹ ë•Œ í‘œì‹œ */}
                    {flightInfo && !isEditMode && (
                        <button
                            onClick={() => setIsEditMode(true)}
                            className="flex items-center gap-1 px-3 py-1 text-xs font-medium text-purple-600 hover:text-purple-700 hover:bg-purple-50 rounded-lg transition-colors"
                        >
                            <Edit2 className="w-3.5 h-3.5" />
                            ë³€ê²½
                        </button>
                    )}
                </div>
            </div>

            {/* ë©”ì¸ ì»¨í…ì¸ : ì¹´ë“œ ë·° ë˜ëŠ” ì…ë ¥ í¼ */}
            {destinationCard ? (
                <>
                    {/* ì¹´ë“œ ë·°: í•­ê³µ ì •ë³´ê°€ ìˆê³  í¸ì§‘ ëª¨ë“œê°€ ì•„ë‹ ë•Œ */}
                    {flightInfo && !isEditMode ? (
                        <div
                            className={`min-h-[72px] rounded-xl transition-all duration-200 ease-in-out flex flex-col overflow-hidden ${isOver
                                ? 'border-purple-500 bg-purple-50/50 ring-2 ring-purple-100 border-dashed'
                                : 'bg-white border-gray-200 border shadow-sm'
                                }`}
                        >
                            {/* ê°€ëŠ”í¸ ì¹´ë“œ */}
                            <div className="flex items-center gap-0 border-b border-gray-100 h-[72px] relative">
                                {/* ì™¼ìª½ ìƒ‰ìƒ ë°” */}
                                <div className="absolute left-0 top-2 bottom-2 w-1 rounded-r-full bg-purple-500"></div>
                                <div className="flex items-center gap-3 p-4 flex-1">
                                    <div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center shrink-0">
                                        <Plane className="w-5 h-5 text-purple-600" />
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <div className="flex items-center gap-2 mb-0.5">
                                            <span className="text-xs font-bold text-purple-600">ğŸ›« ê°€ëŠ”í¸</span>
                                            <span className="text-[10px] text-slate-400">{flightInfo.outbound.airline}</span>
                                        </div>
                                        <p className="text-sm font-medium text-slate-700 truncate mb-0.5">
                                            {flightInfo.outbound.departureAirport.split('(')[0].trim()} â†’ {flightInfo.outbound.arrivalAirport.split('(')[0].trim()}
                                        </p>
                                        <p className="text-xs text-slate-500">
                                            {new Date(flightInfo.outbound.date).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })} {flightInfo.outbound.time} â†’ {flightInfo.outbound.arrivalDate ? new Date(flightInfo.outbound.arrivalDate).toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' }) + ' ' : ''}{flightInfo.outbound.arrivalTime || ''}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            {/* ì˜¤ëŠ”í¸ ì¹´ë“œ */}
                            <div className="flex items-center gap-0 h-[72px] relative">
                                {/* ì™¼ìª½ ìƒ‰ìƒ ë°” */}
                                <div className="absolute left-0 top-2 bottom-2 w-1 rounded-r-full bg-purple-500"></div>
                                <div className="flex items-center gap-3 p-4 flex-1">
                                    <div className="w-10 h-10 rounded-full bg-purple-100 flex items-center justify-center shrink-0">
                                        <Plane className="w-5 h-5 text-purple-600 rotate-180" />
                                    </div>
                                    <div className="flex-1 min-w-0">
                                        <div className="flex items-center gap-2 mb-0.5">
                                            <span className="text-xs font-bold text-purple-600">ğŸ›¬ ì˜¤ëŠ”í¸</span>
                                            <span className="text-[10px] text-slate-400">{flightInfo.return.airline}</span>
                                        </div>
                                        <p className="text-sm font-medium text-slate-700 truncate mb-0.5">
                                            {flightInfo.return.departureAirport.split('(')[0].trim()} â†’ {flightInfo.return.arrivalAirport.split('(')[0].trim()}
                                        </p>
                                        <p className="text-xs text-slate-500">
                                            {new Date(flightInfo.return.date).toLocaleDateString('ko-KR', { month: 'long', day: 'numeric' })} {flightInfo.return.time} â†’ {flightInfo.return.arrivalDate ? new Date(flightInfo.return.arrivalDate).toLocaleDateString('ko-KR', { month: 'numeric', day: 'numeric' }) + ' ' : ''}{flightInfo.return.arrivalTime || ''}
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ) : (
                        /* ì…ë ¥ í¼: í•­ê³µ ì •ë³´ê°€ ì—†ê±°ë‚˜ í¸ì§‘ ëª¨ë“œì¼ ë•Œ */
                        <div
                            className={`min-h-[300px] rounded-xl border shadow-sm transition-all duration-200 p-6 ${isOver ? 'border-purple-500 bg-purple-50/50 ring-2 ring-purple-100' : 'bg-white border-gray-200'
                                }`}
                        >
                            <div className="space-y-6">
                                {/* ë‚ ì§œ ì„ íƒ */}
                                <div>
                                    <label className="block text-xs text-slate-500 mb-2">ì—¬í–‰ ê¸°ê°„</label>
                                    <button
                                        onClick={() => setShowDatePicker(true)}
                                        className="w-full px-4 py-3 border border-gray-200 rounded-lg text-left hover:border-purple-500 transition-colors flex items-center gap-3"
                                    >
                                        <Calendar className="w-5 h-5 text-purple-500" />
                                        <div className="flex-1">
                                            {departureDate && arrivalDate ? (
                                                <span className="text-sm font-medium text-slate-700">
                                                    {departureDate.toLocaleDateString('ko-KR')} ~ {arrivalDate.toLocaleDateString('ko-KR')}
                                                </span>
                                            ) : (
                                                <span className="text-sm text-slate-400">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
                                            )}
                                        </div>
                                    </button>
                                </div>

                                {/* ê°€ëŠ”í¸ (Outbound) */}
                                <div>
                                    <div className="flex items-center gap-2 mb-3">
                                        <Plane className="w-5 h-5 text-purple-500" />
                                        <h4 className="font-semibold text-slate-700">ê°€ëŠ”í¸</h4>
                                    </div>

                                    {/* ê³µí•­ */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                        <div>
                                            <label className="block text-xs text-slate-500 mb-1">ì¶œë°œ ê³µí•­</label>
                                            <select
                                                value={outboundDepartureAirport}
                                                onChange={(e) => setOutboundDepartureAirport(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"
                                            >
                                                {KOREAN_AIRPORTS.map(airport => (
                                                    <option key={airport.code} value={`${airport.name} (${airport.code})`}>
                                                        {airport.name} ({airport.code})
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-xs text-slate-500 mb-1">ë„ì°© ê³µí•­</label>
                                            {hasMultipleAirports ? (
                                                <select
                                                    value={outboundArrivalAirport}
                                                    onChange={(e) => setOutboundArrivalAirport(e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"
                                                >
                                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                                    {destinationAirports.map(airport => (
                                                        <option key={airport.code} value={`${airport.name} (${airport.code})`}>
                                                            {airport.name} ({airport.code})
                                                        </option>
                                                    ))}
                                                </select>
                                            ) : (
                                                <input
                                                    type="text"
                                                    value={outboundArrivalAirport}
                                                    readOnly
                                                    className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm bg-gray-50 cursor-not-allowed"
                                                />
                                            )}
                                        </div>
                                    </div>

                                    {/* ì‹œê°„/í•­ê³µì‚¬ */}
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <TimeSelect
                                                label="ì¶œë°œ ì‹œê°„"
                                                hour={outboundHour}
                                                minute={outboundMinute}
                                                onHourChange={setOutboundHour}
                                                onMinuteChange={setOutboundMinute}
                                            />
                                            <TimeSelect
                                                label="ë„ì°© ì‹œê°„"
                                                hour={outboundArrivalHour}
                                                minute={outboundArrivalMinute}
                                                onHourChange={setOutboundArrivalHour}
                                                onMinuteChange={setOutboundArrivalMinute}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs text-slate-500 mb-1">í•­ê³µì‚¬</label>
                                            <Autocomplete
                                                value={outboundAirline}
                                                onChange={setOutboundAirline}
                                                suggestions={MAJOR_AIRLINES}
                                                placeholder="ëŒ€í•œí•­ê³µ"
                                                className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* ì˜¤ëŠ”í¸ (Return) */}
                                <div>
                                    <div className="flex items-center gap-2 mb-3">
                                        <Plane className="w-5 h-5 text-purple-500 rotate-180" />
                                        <h4 className="font-semibold text-slate-700">ì˜¤ëŠ”í¸</h4>
                                    </div>

                                    {/* ê³µí•­ (ê¸°ë³¸ê°’ ìë™, ë³€ê²½ ê°€ëŠ¥) */}
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-3 mb-3">
                                        <div>
                                            <label className="block text-xs text-slate-500 mb-1">ì¶œë°œ ê³µí•­</label>
                                            {isReturnDepartureCustom ? (
                                                <div className="relative">
                                                    <Autocomplete
                                                        value={returnDepartureAirport}
                                                        onChange={setReturnDepartureAirport}
                                                        suggestions={MAJOR_AIRPORTS.map(a => `${a.name} (${a.code})`)}
                                                        placeholder="ê³µí•­ëª… ì…ë ¥ (ì˜ˆ: ê°„ì‚¬ì´êµ­ì œê³µí•­)"
                                                        className="w-full px-3 py-2 pr-20 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                                                        autoFocus
                                                    />
                                                    <button
                                                        type="button"
                                                        onClick={() => {
                                                            setIsReturnDepartureCustom(false);
                                                            setReturnDepartureAirport(outboundArrivalAirport);
                                                        }}
                                                        className="absolute right-2 top-1/2 -translate-y-1/2 text-xs text-purple-600 hover:text-purple-700 font-medium"
                                                    >
                                                        ëª©ë¡ì„ íƒ
                                                    </button>
                                                </div>
                                            ) : (
                                                <select
                                                    value={returnDepartureAirport}
                                                    onChange={(e) => {
                                                        if (e.target.value === '__CUSTOM__') {
                                                            setIsReturnDepartureCustom(true);
                                                            setReturnDepartureAirport('');
                                                        } else {
                                                            setReturnDepartureAirport(e.target.value);
                                                        }
                                                    }}
                                                    className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"
                                                >
                                                    <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                                    {destinationAirports.map(airport => (
                                                        <option key={airport.code} value={`${airport.name} (${airport.code})`}>
                                                            {airport.name} ({airport.code})
                                                        </option>
                                                    ))}
                                                    <option value="__CUSTOM__">ì§ì ‘ì…ë ¥</option>
                                                </select>
                                            )}
                                        </div>
                                        <div>
                                            <label className="block text-xs text-slate-500 mb-1">ë„ì°© ê³µí•­</label>
                                            <select
                                                value={returnArrivalAirport}
                                                onChange={(e) => setReturnArrivalAirport(e.target.value)}
                                                className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500 bg-white"
                                            >
                                                {KOREAN_AIRPORTS.map(airport => (
                                                    <option key={airport.code} value={`${airport.name} (${airport.code})`}>
                                                        {airport.name} ({airport.code})
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    </div>

                                    {/* ì‹œê°„/í•­ê³µì‚¬ */}
                                    <div className="space-y-3">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                            <TimeSelect
                                                label="ì¶œë°œ ì‹œê°„"
                                                hour={returnHour}
                                                minute={returnMinute}
                                                onHourChange={setReturnHour}
                                                onMinuteChange={setReturnMinute}
                                            />
                                            <TimeSelect
                                                label="ë„ì°© ì‹œê°„"
                                                hour={returnArrivalHour}
                                                minute={returnArrivalMinute}
                                                onHourChange={setReturnArrivalHour}
                                                onMinuteChange={setReturnArrivalMinute}
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs text-slate-500 mb-1">í•­ê³µì‚¬</label>
                                            <Autocomplete
                                                value={returnAirline}
                                                onChange={setReturnAirline}
                                                suggestions={MAJOR_AIRLINES}
                                                placeholder="ëŒ€í•œí•­ê³µ"
                                                className="w-full px-3 py-2 border border-gray-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-purple-500"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* í™•ì • ë²„íŠ¼ */}
                                <div className="flex justify-center pt-2">
                                    <button
                                        onClick={handleConfirm}
                                        className="px-6 py-2.5 bg-purple-500 hover:bg-purple-600 text-white rounded-lg font-semibold transition-colors shadow-sm"
                                    >
                                        í™•ì •í•˜ê¸°
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </>
            ) : (
                // ì—¬í–‰ì§€ ë¯¸ì„ íƒ ì‹œ ë¹ˆ ë“œë¡­ì¡´
                <div className="min-h-[72px] rounded-xl border shadow-sm bg-white border-gray-200 text-center py-6 flex items-center justify-center">
                    <p className="text-xs text-slate-300 font-medium">ì—¬í–‰ì§€ë¥¼ ë¨¼ì € ì„ íƒí•˜ì„¸ìš”</p>
                </div>
            )}

            {/* Date Picker Modal */}
            {
                showDatePicker && (
                    <DateRangePicker
                        onConfirm={handleDateConfirm}
                        onClose={() => setShowDatePicker(false)}
                    />
                )
            }
        </div >
    );
}
